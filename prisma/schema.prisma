generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// =======================
// ğŸ·ï¸ ENUMS
// =======================

enum Status {
  ATIVO
  INATIVO
  BANIDO
}

enum TipoBanimento {
  TEMPORARIO_15_DIAS  // Banimento por 15 dias
  TEMPORARIO_30_DIAS  // Banimento por 30 dias  
  TEMPORARIO_90_DIAS  // Banimento por 90 dias
  TEMPORARIO_120_DIAS // Banimento por 120 dias
  PERMANENTE          // Banimento indefinido
}

enum TipoUsuario {
  PESSOA_FISICA    
  PESSOA_JURIDICA  
}

enum Role {
  ADMIN
  ADMINISTRATOR
  FINANCIAL
  PROFESSOR
  STUDENT
  COMPANY
  PEDAGOGICAL
  RECRUITER
  HR
}

enum TipoAcao {
  LOGIN
  LOGOUT
  CRIACAO
  ATUALIZACAO
  EXCLUSAO
  ACESSO_NEGADO
  TENTATIVA_SUSPEITA // ğŸ”§ Corrigido: era "TENTATIVA_SUSPICAO"
  BANIMENTO_APLICADO
  BANIMENTO_REMOVIDO
  BANIMENTO_EXPIRADO
}

enum TipoServico {
  CONSULTORIA
  RECRUTAMENTO
}

// =======================
// ğŸ‘¥ MODELOS DE USUÃRIO
// =======================

/**
 * ğŸ‘¤ Modelo principal do usuÃ¡rio
 * ContÃ©m dados essenciais de autenticaÃ§Ã£o, identificaÃ§Ã£o e controle de banimento
 */
model Usuario {
  id           String     @id @default(uuid())
  
  // ğŸ“ Dados pessoais bÃ¡sicos
  nome         String     @db.VarChar(255) // ğŸ”§ Renomeado de nomeCompleto para consistÃªncia
  cpf          String?    @unique @db.Char(11) // ObrigatÃ³rio apenas para pessoa fÃ­sica
  cnpj         String?    @unique @db.Char(14) // ObrigatÃ³rio apenas para pessoa jurÃ­dica
  dataNasc     DateTime?  @map("data_nascimento")
  telefone     String?    @db.VarChar(20)
  genero       String?    @db.VarChar(20)

  // ğŸ” Dados de autenticaÃ§Ã£o
  email        String     @unique @db.VarChar(255)
  senha        String     @db.VarChar(255)
  matricula    String     @unique @db.VarChar(8) // ğŸ†• Adicionado para consistÃªncia com o cÃ³digo
  
  // âš–ï¸ ConfiguraÃ§Ãµes e controle
  tipoUsuario  TipoUsuario
  role         Role        @default(STUDENT)
  status       Status      @default(ATIVO)
  aceitarTermos Boolean    @default(false) @map("aceitar_termos")

  // ğŸš« Controle de banimento
  tipoBanimento TipoBanimento? @map("tipo_banimento")
  dataInicioBanimento DateTime? @map("data_inicio_banimento")
  dataFimBanimento DateTime? @map("data_fim_banimento")
  motivoBanimento String? @db.Text @map("motivo_banimento")
  banidoPor String? @map("banido_por") // ID do admin que aplicou o banimento

  // ğŸ”„ Tokens e sessÃ£o
  refreshToken String?     @db.Text @map("refresh_token")

  // ğŸ“… Timestamps
  criadoEm     DateTime    @default(now()) @map("criado_em")
  atualizadoEm DateTime    @updatedAt @map("atualizado_em")
  ultimoLogin  DateTime?   @map("ultimo_login")

  // ğŸ”— Relacionamentos
  perfil       PerfilUsuario?
  logs         LogAuditoria[]

  @@map("usuarios")
  @@index([email, status]) // Busca por email ativo
  @@index([matricula]) // ğŸ†• Ãndice para matrÃ­cula
  @@index([cpf]) // Busca por CPF
  @@index([cnpj]) // Busca por CNPJ
  @@index([status, role]) // ğŸ†• Ãndice composto para filtros administrativos
  @@index([status, dataFimBanimento]) // ğŸ†• VerificaÃ§Ã£o de banimentos expirados
  @@index([banidoPor]) // ğŸ†• Auditoria de banimentos por admin
}

/**
 * ğŸ“‹ Perfil complementar do usuÃ¡rio
 * Dados opcionais, especÃ­ficos por tipo de usuÃ¡rio e endereÃ§o completo
 */
model PerfilUsuario {
  id           String   @id @default(uuid())
  usuarioId    String   @unique @map("usuario_id")

  // ğŸ”— Relacionamento
  usuario      Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  // ğŸ¢ Dados empresariais (opcional para pessoa jurÃ­dica)
  razaoSocial  String?  @db.VarChar(255) @map("razao_social")
  nomeFantasia String?  @db.VarChar(255) @map("nome_fantasia")

  // ğŸ“ EndereÃ§o completo (todos opcionais)
  cep          String?  @db.VarChar(8)
  logradouro   String?  @db.VarChar(255) // Rua, Avenida, etc.
  numero       String?  @db.VarChar(20)
  complemento  String?  @db.VarChar(100) // Apto, Bloco, etc.
  bairro       String?  @db.VarChar(100)
  cidade       String?  @db.VarChar(100)
  estado       String?  @db.VarChar(2) // UF
  pais         String?  @db.VarChar(100) @default("Brasil")
  referencia   String?  @db.VarChar(255) // Ponto de referÃªncia

  // ğŸ“… Timestamps
  criadoEm     DateTime @default(now()) @map("criado_em")
  atualizadoEm DateTime @updatedAt @map("atualizado_em")

  @@map("perfis_usuarios")
  @@index([cep]) // ğŸ†• Busca geogrÃ¡fica por CEP
  @@index([cidade, estado]) // ğŸ†• Busca por localizaÃ§Ã£o
}

/**
 * ğŸ“œ Sistema de auditoria e logs
 * Rastreia todas as aÃ§Ãµes importantes do sistema
 */
model LogAuditoria {
  id          String     @id @default(uuid())
  usuarioId   String?    @map("usuario_id")

  // ğŸ”— Relacionamento opcional (logs podem existir sem usuÃ¡rio)
  usuario     Usuario?   @relation(fields: [usuarioId], references: [id], onDelete: SetNull)

  // ğŸ“ Dados da aÃ§Ã£o
  acao        TipoAcao
  descricao   String     @db.Text
  ipAddress   String?    @db.VarChar(45) @map("ip_address")
  userAgent   String?    @db.Text @map("user_agent")

  // ğŸ“… Timestamp
  criadoEm    DateTime   @default(now()) @map("criado_em")

  @@map("logs_auditoria")
  @@index([usuarioId, criadoEm]) // Logs por usuÃ¡rio ordenados por data
  @@index([acao, criadoEm]) // Logs por tipo de aÃ§Ã£o
  @@index([criadoEm]) // ğŸ†• Ãndice para limpeza de logs antigos
}

/**
 * ğŸ›¡ï¸ Controle de rate limiting
 * Previne ataques de forÃ§a bruta
 */
model RateLimit {
  id              String    @id @default(uuid())
  chave           String    @unique @db.VarChar(255)
  tentativas      Int       @default(0)
  ultimaTentativa DateTime  @default(now()) @map("ultima_tentativa")
  bloqueadoAte    DateTime? @map("bloqueado_ate")

  @@map("rate_limits")
  @@index([ultimaTentativa]) // Limpeza de registros antigos
  @@index([bloqueadoAte]) // ğŸ†• VerificaÃ§Ã£o de bloqueios ativos
}

// =======================
// ğŸŒ MODELOS DO WEBSITE
// =======================

/**
 * â„¹ï¸ SeÃ§Ã£o "Sobre" da pÃ¡gina inicial
 */
model Sobre {
  id          Int      @id @default(autoincrement())
  imagemUrl   String   @db.VarChar(500) @map("imagem_url")
  titulo      String   @db.VarChar(255)
  descricao   String   @db.Text
  
  // ğŸ“… Timestamps
  criadoEm    DateTime @default(now()) @map("criado_em")
  atualizadoEm DateTime @updatedAt @map("atualizado_em")

  @@map("sobre")
}

/**
 * ğŸ–¼ï¸ Banners do site
 */
model Banner {
  id         Int      @id @default(autoincrement())
  imagemUrl  String   @db.VarChar(500) @map("imagem_url")
  linkUrl    String   @db.VarChar(500) @map("link_url")
  position   Int      @map("posicao")
  ativo      Boolean  @default(true) // ğŸ†• Controle de exibiÃ§Ã£o

  // ğŸ“… Timestamps
  criadoEm   DateTime @default(now()) @map("criado_em")
  atualizadoEm DateTime @updatedAt @map("atualizado_em")

  @@map("banners")
  @@index([ativo, position]) // ğŸ†• Busca por banners ativos ordenados
}

/**
 * ğŸ› ï¸ ServiÃ§os oferecidos
 */
model Servico {
  id          Int         @id @default(autoincrement())
  tipo        TipoServico
  imagemUrl   String      @db.VarChar(500) @map("imagem_url")
  titulo      String      @db.VarChar(255)
  descricao   String      @db.Text
  titleButton String      @db.VarChar(100) @map("titulo_botao")
  urlButton   String      @db.VarChar(500) @map("url_botao")
  ativo       Boolean     @default(true) // ğŸ†• Controle de exibiÃ§Ã£o

  // ğŸ“… Timestamps
  criadoEm    DateTime    @default(now()) @map("criado_em")
  atualizadoEm DateTime   @updatedAt @map("atualizado_em")

  @@map("servicos")
  @@index([tipo, ativo]) // ğŸ†• Busca por tipo de serviÃ§o ativo
}

/**
 * ğŸ“„ TÃ­tulos de pÃ¡ginas
 */
model TituloPagina {
  id           Int      @id @default(autoincrement())
  titulo       String   @db.VarChar(255)
  subtitulo    String   @db.VarChar(255)
  descricao    String   @db.VarChar(250)
  textoBotao   String   @db.VarChar(100) @map("texto_botao")
  urlBotao     String   @db.VarChar(500) @map("url_botao")

  // ğŸ“… Timestamps
  criadoEm     DateTime @default(now()) @map("criado_em")
  atualizadoEm DateTime @updatedAt @map("atualizado_em")

  @@map("titulos_pagina")
}

/**
 * ğŸ“Š InformaÃ§Ãµes da empresa Advance
 */
model InformacaoAdvance {
  id        Int      @id @default(autoincrement())
  urlVideo  String   @db.VarChar(500) @map("url_video")
  historia  String   @db.VarChar(500)
  missao    String   @db.VarChar(500)
  visao     String   @db.VarChar(500)

  // ğŸ“… Timestamps
  criadoEm  DateTime @default(now()) @map("criado_em")
  atualizadoEm DateTime @updatedAt @map("atualizado_em")

  @@map("informacoes_advance")
}

/**
 * â­ SeÃ§Ã£o "Por que escolher a Advance"
 */
model PorqueEscolherAdvance {
  id           Int           @id @default(autoincrement())
  titulo       String        @db.VarChar(255)
  descricao    String        @db.VarChar(250)
  textoBotao   String        @db.VarChar(100) @map("texto_botao")
  urlBotao     String        @db.VarChar(500) @map("url_botao")

  // ğŸ”— Relacionamentos
  boxes        BoxDestaque[]

  // ğŸ“… Timestamps
  criadoEm     DateTime      @default(now()) @map("criado_em")
  atualizadoEm DateTime      @updatedAt @map("atualizado_em")

  @@map("porque_escolher_advance")
}

/**
 * ğŸ“¦ Boxes de destaque
 */
model BoxDestaque {
  id                        Int      @id @default(autoincrement())
  icone                     String   @db.VarChar(255)
  titulo                    String   @db.VarChar(255)
  descricao                 String   @db.Text
  ordem                     Int      @default(0) // ğŸ†• Controle de ordem de exibiÃ§Ã£o
  porqueEscolherAdvanceId   Int      @map("porque_escolher_advance_id")

  // ğŸ”— Relacionamento
  porqueEscolherAdvance     PorqueEscolherAdvance @relation(fields: [porqueEscolherAdvanceId], references: [id], onDelete: Cascade)

  @@map("boxes_destaque")
  @@index([porqueEscolherAdvanceId, ordem]) // ğŸ†• OrdenaÃ§Ã£o dos boxes
}

/**
 * ğŸ¢ InformaÃ§Ãµes da empresa
 */
model Empresa {
  id              Int      @id @default(autoincrement())
  imagemUrl       String   @db.VarChar(500) @map("imagem_url")
  titulo          String   @db.VarChar(255)
  descricao       String   @db.VarChar(500)
  tituloImagem    String   @db.VarChar(255) @map("titulo_imagem")
  descricaoImagem String   @db.Text @map("descricao_imagem")
  textoBotao      String   @db.VarChar(100) @map("texto_botao")
  urlBotao        String   @db.VarChar(500) @map("url_botao")

  // ğŸ“… Timestamps
  criadoEm        DateTime @default(now()) @map("criado_em")
  atualizadoEm    DateTime @updatedAt @map("atualizado_em")

  @@map("empresas")
}

/**
 * ğŸ“š TÃ­tulos da pÃ¡gina de cursos
 */
model TituloPaginaCursos {
  id         Int      @id @default(autoincrement())
  titulo     String   @db.VarChar(255)
  subtitulo  String   @db.VarChar(255)
  descricao  String   @db.Text
  textoBotao String   @db.VarChar(100) @map("texto_botao")
  urlBotao   String   @db.VarChar(500) @map("url_botao")

  // ğŸ“… Timestamps
  criadoEm   DateTime @default(now()) @map("criado_em")
  atualizadoEm DateTime @updatedAt @map("atualizado_em")

  @@map("titulos_pagina_cursos")
}

/**
 * ğŸ’¼ Mercado de trabalho
 */
model MercadoTrabalho {
  id         Int                @id @default(autoincrement())
  titulo     String             @db.VarChar(255)
  subtitulo  String             @db.VarChar(255)

  // ğŸ”— Relacionamentos
  destaques  DestaqueMercado[]

  // ğŸ“… Timestamps
  criadoEm   DateTime           @default(now()) @map("criado_em")
  atualizadoEm DateTime         @updatedAt @map("atualizado_em")

  @@map("mercados_trabalho")
}

/**
 * ğŸ¯ Destaques do mercado de trabalho
 */
model DestaqueMercado {
  id                Int              @id @default(autoincrement())
  numeroDestaque    String           @db.VarChar(50) @map("numero_destaque")
  descricaoDestaque String           @db.Text @map("descricao_destaque")
  ordem             Int              @default(0) // ğŸ†• Controle de ordem
  mercadoTrabalhoId Int              @map("mercado_trabalho_id")

  // ğŸ”— Relacionamento
  mercadoTrabalho   MercadoTrabalho @relation(fields: [mercadoTrabalhoId], references: [id], onDelete: Cascade)

  @@map("destaques_mercado")
  @@index([mercadoTrabalhoId, ordem]) // ğŸ†• OrdenaÃ§Ã£o dos destaques
}